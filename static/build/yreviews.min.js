/*! yreviews 2016-08-09 */
function drawPlot(a){function b(){i.domain(p.empty()?j.domain():p.extent()),t.select(".area").attr("d",q),t.select(".x.axis").call(m)}function c(a){return a.date=a.date,a.rating=+a.rating,a}var d={top:10,right:10,bottom:100,left:40},e={top:430,right:10,bottom:20,left:40},f=960-d.left-d.right,g=500-d.top-d.bottom,h=500-e.top-e.bottom,i=(d3.time.format("%b %Y").parse,d3.time.scale().range([0,f])),j=d3.time.scale().range([0,f]),k=d3.scale.linear().range([g,0]),l=d3.scale.linear().range([h,0]),m=d3.svg.axis().scale(i).orient("bottom"),n=d3.svg.axis().scale(j).orient("bottom"),o=d3.svg.axis().scale(k).orient("left"),p=d3.svg.brush().x(j).on("brush",b),q=d3.svg.area().interpolate("monotone").x(function(a){return i(a.date)}).y0(g).y1(function(a){return k(a.rating)}),r=d3.svg.area().interpolate("monotone").x(function(a){return j(a.date)}).y0(h).y1(function(a){return l(a.rating)}),s=d3.select("#reviews-graph").append("svg").attr("width",f+d.left+d.right).attr("height",g+d.top+d.bottom);s.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",f).attr("height",g);var t=s.append("g").attr("class","focus").attr("transform","translate("+d.left+","+d.top+")"),u=s.append("g").attr("class","context").attr("transform","translate("+e.left+","+e.top+")");d3.json(a,c,function(a,b){i.domain(d3.extent(b.map(function(a){return a.date}))),k.domain([0,d3.max(b.map(function(a){return a.rating}))]),j.domain(i.domain()),l.domain(k.domain()),console.log(j.domain(i.domain())),t.append("path").datum(b).attr("class","area").attr("d",q),t.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(m),t.append("g").attr("class","y axis").call(o),u.append("path").datum(b).attr("class","area").attr("d",r),u.append("g").attr("class","x axis").attr("transform","translate(0,"+h+")").call(n),u.append("g").attr("class","x brush").call(p).selectAll("rect").attr("y",-6).attr("height",h+7)})}function handleNewHash(){var a=window.location.hash.replace(/^#\/?|\/$/g,"").split("/");if(""==a[0])var b=React.createElement(Businesses,{location:a});if("reviews"==a[0])var b=React.createElement(Reviews,{location:a});ReactDOM.render(b,document.getElementById("content"))}var Businesses=React.createClass({displayName:"Businesses",getInitialState:function(){return{data:[]}},fetchData:function(a){$.ajax({url:a,dataType:"json",cache:!1,success:function(a){this.setState({data:a})}.bind(this),error:function(b,c,d){console.error(a,c,d.toString())}.bind(this)})},componentDidMount:function(){this.fetchData("/api/v1.0/businesses/")},render:function(){var a=this.state.data.map(function(a){return React.createElement(Business,{icon_url:a.icon_url,name:a.name,id:"#reviews/"+a.id,url:a.url})});return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("h4",null,"Select business")),React.createElement("div",{className:"col-md-6"},React.createElement("ul",{className:"business-list list-group"},a)))}}),Business=React.createClass({displayName:"Business",render:function(){return React.createElement("li",{className:"business-item list-group-item"},React.createElement("a",{href:this.props.id},React.createElement("img",{src:this.props.icon_url,alt:this.props.name,className:"img-thumbnail"})),React.createElement("h4",{className:"list-group-item-heading"},React.createElement("a",{href:this.props.id},this.props.name)),React.createElement("a",{className:"btn btn-info",href:this.props.url,target:"_blank"},"View business on Yelp"),React.createElement("span",{className:"clear"}))}}),Reviews=React.createClass({displayName:"Reviews",getInitialState:function(){return{data:[]}},componentDidMount:function(){drawPlot("/api/v1.0/reviews/"+this.props.location[1]+"/")},render:function(){return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("a",{href:"#",className:"btn btn-default","aria-label":"Left Align"},React.createElement("span",{className:"glyphicon glyphicon-chevron-left","aria-hidden":"true"}),"back")),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12",id:"reviews-graph"})))}});handleNewHash(),window.addEventListener("hashchange",handleNewHash,!1);