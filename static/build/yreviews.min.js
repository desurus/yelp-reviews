/*! yreviews 2016-08-22 */
function handleNewHash(){var a=window.location.hash.replace(/^#\/?|\/$/g,"").split("/");if(""==a[0])var b=React.createElement(Businesses,{location:a});if("reviews"==a[0])var b=React.createElement(Reviews,{location:a});ReactDOM.render(b,document.getElementById("content"))}function drawPlot(a){function b(){h.domain(o.empty()?i.domain():o.extent()),r.selectAll(".bar1").attr("x",function(a){return h(d3.time.format("%b %Y").parse(a.date))-10}).attr("height",function(a){return f-j(a.rating)}).attr("width",function(a){return 10}),r.selectAll(".bar2").attr("x",function(a){return h(d3.time.format("%b %Y").parse(a.date))}).attr("height",function(a){return f-j(a.score)}).attr("width",function(a){return 10}),r.select(".x.axis").call(l)}var c={top:10,right:10,bottom:100,left:40},d={top:430,right:10,bottom:20,left:40},e=960-c.left-c.right,f=500-c.top-c.bottom,g=500-d.top-d.bottom,h=d3.time.scale().range([0,e]),i=d3.time.scale().range([0,e]),j=d3.scale.linear().range([f,0]),k=d3.scale.linear().range([g,0]),l=d3.svg.axis().scale(h).orient("bottom"),m=d3.svg.axis().scale(i).orient("bottom"),n=d3.svg.axis().scale(j).orient("left"),o=d3.svg.brush().x(i).on("brush",b),p=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return"<h4>"+a.date+" Avarage reviews:</h4><p><strong>Users rating:</strong> <span style='color:red;'>"+a.rating+"</span></p><p><strong>Calculated rating:</strong> <span style='color:red;'>"+a.score+"</span></p><p><strong>Number of reviews:</strong> <span style='color:red;'>"+a.num_reviews+"</span></p>"}),q=d3.select("#reviews-graph").attr("width",e+c.left+c.right).attr("height",f+c.top+c.bottom);q.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e).attr("height",f),q.call(p);var r=q.append("g").attr("class","focus").attr("transform","translate("+c.left+","+c.top+")"),s=q.append("g").attr("class","context").attr("transform","translate("+d.left+","+d.top+")");d3.json(a,function(a,b){h.domain(d3.extent(b.map(function(a){return d3.time.format("%b %Y").parse(a.date)}))),j.domain([0,d3.max(b,function(a){return+a.rating})]),i.domain(h.domain()),k.domain(j.domain()),r.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(l),r.append("g").attr("class","y axis").call(n),bars_holder=r.append("g").attr("clip-path","url(#clip)"),bars=bars_holder.selectAll(".bar").data(b).enter(),bars.append("rect").attr("class","bar1 bar").attr("x",function(a){return h(d3.time.format("%b %Y").parse(a.date))-4}).attr("width",e/b.length/2).attr("y",function(a){return j(a.rating)}).attr("height",function(a){return f-j(a.rating)}).on("mouseover",p.show).on("mouseout",p.hide),bars.append("rect").attr("class","bar2 bar").attr("x",function(a){return h(d3.time.format("%b %Y").parse(a.date))}).attr("width",e/b.length/2).attr("y",function(a){return j(a.score)}).attr("height",function(a){return f-j(a.score)}).on("mouseover",p.show).on("mouseout",p.hide),s.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(m),bars2=s.selectAll(".bar").data(b).enter(),bars2.append("rect").attr("class","bar1").attr("x",function(a){return i(d3.time.format("%b %Y").parse(a.date))}).attr("width",e/b.length/2).attr("y",function(a){return k(a.rating)}).attr("height",function(a){return g-k(a.rating)}),bars2.append("rect").attr("class","bar2").attr("x",function(a){return i(d3.time.format("%b %Y").parse(a.date))-4}).attr("width",e/b.length/2).attr("y",function(a){return k(a.score)}).attr("height",function(a){return g-k(a.score)}),s.append("g").attr("class","x brush").call(o).selectAll("rect").attr("y",-6).attr("height",g+7)})}var Businesses=React.createClass({displayName:"Businesses",getInitialState:function(){return{data:[]}},fetchData:function(a){$.ajax({url:a,dataType:"json",cache:!1,success:function(a){this.setState({data:a})}.bind(this),error:function(b,c,d){console.error(a,c,d.toString())}.bind(this)})},componentDidMount:function(){this.fetchData("/api/v1.0/businesses/")},render:function(){var a=this.state.data.map(function(a){return React.createElement(Business,{icon_url:a.icon_url,name:a.name,id:"#reviews/"+a.id,url:a.url})});return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("h4",null,"Select business")),React.createElement("div",{className:"col-md-6"},React.createElement("ul",{className:"business-list list-group"},a)))}}),Business=React.createClass({displayName:"Business",render:function(){return React.createElement("li",{className:"business-item list-group-item"},React.createElement("img",{src:this.props.icon_url,alt:this.props.name,className:"img-thumbnail"}),React.createElement("h4",{className:"list-group-item-heading"},React.createElement("a",{href:this.props.url,target:"_blank"},this.props.name," on Yelp Â ",React.createElement("span",{className:"glyphicon glyphicon-new-window","aria-hidden":"true"}))),React.createElement("a",{className:"btn btn-info",href:this.props.id},"View reviews statistics"),React.createElement("span",{className:"clear"}))}}),Reviews=React.createClass({displayName:"Reviews",getInitialState:function(){return{data:[]}},componentDidMount:function(){this.fetchData("/api/v1.0/businesses/"+this.props.location[1]+"/"),drawPlot("/api/v1.0/reviews/"+this.props.location[1]+"/")},fetchData:function(a){$.ajax({url:a,dataType:"json",cache:!1,success:function(a){this.setState({data:a})}.bind(this),error:function(b,c,d){console.error(a,c,d.toString())}.bind(this)})},render:function(){return console.log(this.state.data),null!=this.state.data[0]?business_name=this.state.data[0].name:business_name="",React.createElement("div",{className:"col-md-12"},React.createElement("a",{href:"#",className:"btn btn-default","aria-label":"Left Align"},React.createElement("span",{className:"glyphicon glyphicon-chevron-left","aria-hidden":"true"}),"back"),React.createElement("h2",null,business_name),React.createElement("p",{className:"lead"},"This bar-chart visually represents avarage rating for the given business left by the reviewrs.",React.createElement("br",null),"It's compared to the calculated avarage based on the text review using NLP algorithm."),React.createElement("svg",{id:"reviews-graph"}),React.createElement("p",null,React.createElement("span",{className:"users-review"})," - Average rate by the user",React.createElement("br",null),React.createElement("span",{className:"calculated-review"})," - Average rcalculated rating"))}});handleNewHash(),window.addEventListener("hashchange",handleNewHash,!1);