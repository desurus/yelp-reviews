/*! yreviews 2016-08-16 */
function handleNewHash(){var a=window.location.hash.replace(/^#\/?|\/$/g,"").split("/");if(""==a[0])var b=React.createElement(Businesses,{location:a});if("reviews"==a[0])var b=React.createElement(Reviews,{location:a});ReactDOM.render(b,document.getElementById("content"))}function drawPlot(a){function b(a){return a.frequency=+a.frequency,a}var c={top:40,right:20,bottom:30,left:40},d=960-c.left-c.right,e=500-c.top-c.bottom,f=d3.format(".0%"),g=d3.scale.ordinal().rangeRoundBands([0,d],.1),h=d3.scale.linear().range([e,0]),i=d3.svg.axis().scale(g).orient("bottom"),j=d3.svg.axis().scale(h).orient("left").tickFormat(f),k=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return"<strong>Frequency:</strong> <span style='color:red'>"+a.frequency+"</span>"}),l=d3.select("body").append("svg").attr("width",d+c.left+c.right).attr("height",e+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")");l.call(k),d3.tsv("data.tsv",b,function(a,b){g.domain(b.map(function(a){return a.letter})),h.domain([0,d3.max(b,function(a){return a.frequency})]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")").call(i),l.append("g").attr("class","y axis").call(j).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Frequency"),l.selectAll(".bar").data(b).enter().append("rect").attr("class","bar").attr("x",function(a){return g(a.letter)}).attr("width",g.rangeBand()).attr("y",function(a){return h(a.frequency)}).attr("height",function(a){return e-h(a.frequency)}).on("mouseover",k.show).on("mouseout",k.hide)})}var Businesses=React.createClass({displayName:"Businesses",getInitialState:function(){return{data:[]}},fetchData:function(a){$.ajax({url:a,dataType:"json",cache:!1,success:function(a){this.setState({data:a})}.bind(this),error:function(b,c,d){console.error(a,c,d.toString())}.bind(this)})},componentDidMount:function(){this.fetchData("/api/v1.0/businesses/")},render:function(){var a=this.state.data.map(function(a){return React.createElement(Business,{icon_url:a.icon_url,name:a.name,id:"#reviews/"+a.id,url:a.url})});return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("h4",null,"Select business")),React.createElement("div",{className:"col-md-6"},React.createElement("ul",{className:"business-list list-group"},a)))}}),Business=React.createClass({displayName:"Business",render:function(){return React.createElement("li",{className:"business-item list-group-item"},React.createElement("a",{href:this.props.id},React.createElement("img",{src:this.props.icon_url,alt:this.props.name,className:"img-thumbnail"})),React.createElement("h4",{className:"list-group-item-heading"},React.createElement("a",{href:this.props.id},this.props.name)),React.createElement("a",{className:"btn btn-info",href:this.props.url,target:"_blank"},"View business on Yelp"),React.createElement("span",{className:"clear"}))}}),Reviews=React.createClass({displayName:"Reviews",getInitialState:function(){return{data:[]}},componentDidMount:function(){drawPlot("/api/v1.0/reviews/"+this.props.location[1]+"/")},render:function(){return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("a",{href:"#",className:"btn btn-default","aria-label":"Left Align"},React.createElement("span",{className:"glyphicon glyphicon-chevron-left","aria-hidden":"true"}),"back")),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("svg",{id:"reviews-graph"}))))}});handleNewHash(),window.addEventListener("hashchange",handleNewHash,!1);