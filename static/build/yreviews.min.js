/*! yreviews 2016-08-10 */
function drawPlot(a){function b(){h.domain(o.empty()?i.domain():o.extent()),s.select(".area").attr("d",p),s.select(".x.axis").call(l)}var c={top:10,right:10,bottom:100,left:40},d={top:430,right:10,bottom:20,left:40},e=960-c.left-c.right,f=500-c.top-c.bottom,g=500-d.top-d.bottom,h=d3.time.scale().range([0,e]),i=d3.time.scale().range([0,e]),j=d3.scale.linear().range([f,0]),k=d3.scale.linear().range([g,0]),l=d3.svg.axis().scale(h).orient("bottom"),m=d3.svg.axis().scale(i).orient("bottom"),n=d3.svg.axis().scale(j).orient("left"),o=d3.svg.brush().x(i).on("brush",b),p=d3.svg.area().interpolate("monotone").x(function(a){return h(d3.time.format("%b %Y").parse(a.date))}).y0(f).y1(function(a){return j(a.rating)}),q=d3.svg.area().interpolate("monotone").x(function(a){return i(d3.time.format("%b %Y").parse(a.date))}).y0(g).y1(function(a){return k(a.rating)}),r=d3.select("#reviews-graph").attr("width",e+c.left+c.right).attr("height",f+c.top+c.bottom);r.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e).attr("height",f);var s=r.append("g").attr("class","focus").attr("transform","translate("+c.left+","+c.top+")"),t=r.append("g").attr("class","context").attr("transform","translate("+d.left+","+d.top+")");d3.json(a,function(a,b){h.domain(d3.extent(b.map(function(a){return d3.time.format("%b %Y").parse(a.date)}))),j.domain([0,d3.max(b.map(function(a){return+a.rating}))]),i.domain(h.domain()),k.domain(j.domain()),s.append("path").datum(b).attr("class","area").attr("d",p),s.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(l),s.append("g").attr("class","y axis").call(n),t.append("path").datum(b).attr("class","area").attr("d",q),t.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(m),t.append("g").attr("class","x brush").call(o).selectAll("rect").attr("y",-6).attr("height",g+7)})}function handleNewHash(){var a=window.location.hash.replace(/^#\/?|\/$/g,"").split("/");if(""==a[0])var b=React.createElement(Businesses,{location:a});if("reviews"==a[0])var b=React.createElement(Reviews,{location:a});ReactDOM.render(b,document.getElementById("content"))}var Businesses=React.createClass({displayName:"Businesses",getInitialState:function(){return{data:[]}},fetchData:function(a){$.ajax({url:a,dataType:"json",cache:!1,success:function(a){this.setState({data:a})}.bind(this),error:function(b,c,d){console.error(a,c,d.toString())}.bind(this)})},componentDidMount:function(){this.fetchData("/api/v1.0/businesses/")},render:function(){var a=this.state.data.map(function(a){return React.createElement(Business,{icon_url:a.icon_url,name:a.name,id:"#reviews/"+a.id,url:a.url})});return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("h4",null,"Select business")),React.createElement("div",{className:"col-md-6"},React.createElement("ul",{className:"business-list list-group"},a)))}}),Business=React.createClass({displayName:"Business",render:function(){return React.createElement("li",{className:"business-item list-group-item"},React.createElement("a",{href:this.props.id},React.createElement("img",{src:this.props.icon_url,alt:this.props.name,className:"img-thumbnail"})),React.createElement("h4",{className:"list-group-item-heading"},React.createElement("a",{href:this.props.id},this.props.name)),React.createElement("a",{className:"btn btn-info",href:this.props.url,target:"_blank"},"View business on Yelp"),React.createElement("span",{className:"clear"}))}}),Reviews=React.createClass({displayName:"Reviews",getInitialState:function(){return{data:[]}},componentDidMount:function(){drawPlot("/api/v1.0/reviews/"+this.props.location[1]+"/")},render:function(){return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("a",{href:"#",className:"btn btn-default","aria-label":"Left Align"},React.createElement("span",{className:"glyphicon glyphicon-chevron-left","aria-hidden":"true"}),"back")),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("svg",{id:"reviews-graph"}))))}});handleNewHash(),window.addEventListener("hashchange",handleNewHash,!1);